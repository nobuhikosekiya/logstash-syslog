input {
  file {
    path => "/logs/*.log"
    start_position => "beginning"
    sincedb_path => "/usr/share/logstash/data/sincedb"
    type => "syslog"
  }
}

filter {
  grok {
    match => { "message" => "%{SYSLOGTIMESTAMP:system_timestamp} %{SYSLOGHOST:host.name} %{GREEDYDATA:message}" }
    overwrite => [ "message" ]
  }
  
  date {
    match => [ "system_timestamp", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss" ]
    target => "@timestamp"
  }
  
  mutate {
    remove_field => [ "system_timestamp" ]
  }
}

output {
  elasticsearch {
    cloud_id => "${CLOUD_ID}"
    api_key => "${ELASTIC_API_KEY}"
    data_stream => true
    data_stream_type => "logs"
    data_stream_dataset => "syslog"
    data_stream_namespace => "default"
  }
  
  # Uncomment for debugging
  # stdout { codec => rubydebug }
}